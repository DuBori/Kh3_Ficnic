<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 사이트 : 피크닉 관련 -->
<mapper namespace="ficnicDAO">

    <!-- 피크닉 목록 -->
    <select id="SiteFicnicList" resultType="ficnicDTO">
    
    </select>
    
    
    <!--검색 해당 카테고리 피크닉 개수  -->
	<select id="SiteFicnicSearchCount" parameterType="map" resultType="int">		
		select count(*) from ficnic_list
		<![CDATA[where ficnic_no > 0]]>
        and (
            substr(ficnic_category_no,1,${next_num}) = #{parent_str}
            or substr(ficnic_category_sub1,1,${next_num}) = #{parent_str}
            or substr(ficnic_category_sub2,1,${next_num}) = #{parent_str}
            or substr(ficnic_category_sub3,1,${next_num}) = #{parent_str}
        )
	</select>
	
	<!-- 피크닉 검색 리스트  -->
	<select id="SiteFicnicCategoryList" parameterType="map" resultType="ficnicDTO">
			select * from(
	                select
	                    row_number() over(order by ficnic_no desc) rnum,
	                    b.*
	                from (
	                select * from ficnic_list
                    <![CDATA[where ficnic_no > 0]]>
				    and (
				        substr(ficnic_category_no,1,${next_num}) = #{parent_str}
				        or substr(ficnic_category_sub1,1,${next_num}) = #{parent_str}
				        or substr(ficnic_category_sub2,1,${next_num}) = #{parent_str}
				        or substr(ficnic_category_sub3,1,${next_num}) = #{parent_str}
				    )
			)b
			)
			 <![CDATA[
	            where rnum >= #{startNo} and rnum <= #{endNo}
	        ]]>
	        
	        
	</select>

	
	<select id="SiteFicnicChildCategory" parameterType="string" resultType="string">
		select category_id from ficnic_category where category_id_up = #{value}
	</select>
	
	<select id="SiteFicnicReviewList" resultType="reviewDTO">
		select * from review_list
	</select>

	
	<select id="siteFicnicName" parameterType="string" resultType="string">
		select category_name from ficnic_category where category_id = #{ficnic_name}
	</select>
	

    <select id="siteFicnicPointCount" resultType="int">
    select sum(review_point) from review_list where ficnic_no = #{ficnic_no}
 	</select>
 	
 	
 	 <!-- 리뷰 목록 총 갯수 -->
    <select id="siteFicnicCount" resultType="int">
        select count(review_no) from review_list where ficnic_no = #{ficnic_no}
    </select>
 	


</mapper>