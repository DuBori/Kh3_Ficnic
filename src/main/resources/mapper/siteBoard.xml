<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 사이트 : 게시판 관련 -->
<mapper namespace="boardDAO">

    <!-- 게시판 목록 -->
    <select id="siteBoardList" resultType="boardDTO">
    	select * from board_data_${value}
    </select>



	<!-- 페이징 처리 -->
<select id="SiteBoardTotal" parameterType="java.util.Map" resultType="int">
        select count(*) from board_data_${bbs_id}
        <choose>
            <when test="field.equals('title') and keyword != ''">where bdata_title like '%' || #{keyword} || '%'</when>
            <when test="field.equals('cont') and keyword != ''">where bdata_cont like '%' || #{keyword} || '%'</when>
            <when test="field.equals('writer') and keyword != ''">where bdata_writer_id like '%' || #{keyword} || '%'</when>
        </choose>
    </select>


    <select id="SiteBoardList" parameterType="java.util.Map" resultType="boardDto">
        <choose>
            <when test="field.equals('title') and keyword != ''">
		        <![CDATA[
		            select * from
		                (select row_number() over(order by bdata_no desc) rnum, b.* from board_data_${bbs_id} b where bdata_title like '%' || #{keyword} || '%')
		                where rnum >= #{startNo} and rnum <= #{endNo}
		        ]]>
            </when>

            <when test="field.equals('cont') and keyword != ''">
                <![CDATA[
                    select * from
                        (select row_number() over(order by bdata_no desc) rnum, b.* from board_data_${bbs_id} b where bdata_cont like '%' || #{keyword} || '%')
                        where rnum >= #{startNo} and rnum <= #{endNo}
                ]]>
            </when>

            <when test="field.equals('writer') and keyword != ''">
                <![CDATA[
                    select * from
                        (select row_number() over(order by bdata_no desc) rnum, b.* from board_data_${bbs_id} b where bdata_writer_id like '%' || #{keyword} || '%')
                        where rnum >= #{startNo} and rnum <= #{endNo}
                ]]>
            </when>

            <otherwise>
                <![CDATA[
                    select * from
                        (select row_number() over(order by bdata_no desc) rnum, b.* from board_data_${bbs_id} b)
                        where rnum >= #{startNo} and rnum <= #{endNo}
                ]]>
            </otherwise>
        </choose>
    </select>

	<update id="SiteBoardUpdateHit" parameterType="map" >
		update board_data_${bbs_id} set bdata_hit=bdata_hit+1 where bdata_no=#{bdata_no}
	</update>

	<!-- 해당 게시판 해당 게시글 불러오기 -->
	<select id="SiteBoardDto" parameterType="map" resultType="boardDTO">
		select * from board_data_${bbs_id} where bdata_no = #{bdata_no} 
	</select>
	
	<!-- 해당 게시판 게시글 작성 -->
	<insert id="SiteBoardInsert" parameterType="map">
	 	<selectKey resultType="int" keyProperty="dto.bdata_no" order="BEFORE">
           select nvl(max(bdata_no),0) from board_data_${bbs_id}
       </selectKey>
		insert into board_data_${bbs_id} values(#{dto.bdata_no}+1,#{bbs_id},default,#{dto.bdata_category},#{dto.bdata_title},#{dto.bdata_cont},#{dto.bdata_sub},#{dto.bdata_link1},#{dto.bdata_link2},#{dto.bdata_file1},#{dto.bdata_file2},#{dto.bdata_file3},#{dto.bdata_file4},default,#{dto.bdata_use_notice},#{dto.bdata_use_secret},default,default,#{dto.bdata_writer_id},#{dto.bdata_writer_pw},#{dto.bdata_writer_name},sysdate)
	</insert>
	
	<!-- 해당 게시판 게시글 업데이트  -->
	<update id="SiteBoardUpdate" parameterType="map">
		update board_data_${bbs_id} set bdata_category = #{dto.bdata_category}, bdata_title = #{dto.bdata_title}, bdata_cont = #{dto.bdata_cont}, bdata_sub = #{dto.bdata_sub}, bdata_link1 = #{dto.bdata_link1}, bdata_link2 = #{dto.bdata_link2}, bdata_file1 = #{dto.bdata_file1}, bdata_file2 = #{dto.bdata_file2}, bdata_file3 = #{dto.bdata_file3}, bdata_file4 = #{dto.bdata_file4}, bdata_ficnic = #{dto.bdata_ficnic} where bdata_no = #{dto.bdata_no}
	</update>


</mapper>